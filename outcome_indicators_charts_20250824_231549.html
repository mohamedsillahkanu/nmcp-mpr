<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outcome Indicators Bar Charts</title>
    <style>
        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f6f9;
            line-height: 1.6;
            color: #2c3e50;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e3e8ed;
        }
        h1 {
            color: #1e3a8a;
            text-align: center;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 20px;
            margin-bottom: 40px;
            font-size: 2.2em;
            font-weight: 600;
        }
        h2 {
            color: white;
            background-color: #2563eb;
            margin: 40px -30px 30px -30px;
            padding: 20px 30px;
            font-size: 1.6em;
            font-weight: 500;
            border-left: 5px solid #1d4ed8;
            scroll-margin-top: 80px;
        }
        h3 {
            color: #1e3a8a;
            font-size: 1.3em;
            font-weight: 600;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 2px solid #bfdbfe;
            padding-bottom: 8px;
            scroll-margin-top: 80px;
        }
        
        /* Enhanced Navigation Menu Styles */
        .section-nav {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 2px solid #2563eb;
            border-radius: 8px;
            max-width: 350px;
            min-width: 60px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            overflow: hidden;
            max-height: 80vh;
            overflow-y: auto;
        }

        .nav-header {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: 14px;
            user-select: none;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .nav-toggle {
            font-size: 18px;
            transition: transform 0.3s ease;
            line-height: 1;
        }

        .nav-toggle.expanded {
            transform: rotate(180deg);
        }

        .nav-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
        }

        .nav-content.expanded {
            max-height: 1000px;
            padding: 10px 0;
        }

        .nav-main-item {
            display: block;
            color: #2563eb;
            text-decoration: none;
            padding: 8px 15px;
            font-size: 13px;
            font-weight: 600;
            border-bottom: 1px solid #f1f5f9;
            transition: all 0.2s ease;
            cursor: pointer;
            user-select: none;
        }

        .nav-main-item:hover {
            background-color: #eff6ff;
            color: #1d4ed8;
        }

        .nav-main-item.active {
            background-color: #dbeafe;
            color: #1d4ed8;
            border-left: 4px solid #2563eb;
        }

        .nav-sub-item {
            display: block;
            color: #64748b;
            text-decoration: none;
            padding: 6px 20px;
            font-size: 11px;
            transition: all 0.2s ease;
            border-bottom: 1px solid #e2e8f0;
            line-height: 1.3;
        }

        .nav-sub-item:hover {
            background-color: #e0f2fe;
            color: #0369a1;
            padding-left: 25px;
        }

        .nav-sub-item.active {
            background-color: #dbeafe;
            color: #1d4ed8;
            font-weight: 600;
            border-left: 3px solid #2563eb;
        }

        .scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #2563eb, #60a5fa);
            z-index: 1001;
            transition: width 0.3s ease;
        }

        /* Chart Styles */
        .chart-container {
            background-color: #fafbfc;
            border: 1px solid #e3e8ed;
            border-radius: 6px;
            margin: 25px 0;
            padding: 20px;
        }

        .chart-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #1e3a8a;
            font-size: 1.1em;
            background-color: #eff6ff;
            padding: 12px;
            border-radius: 4px;
            border-left: 4px solid #2563eb;
        }

        .chart-svg {
            width: 100%;
            height: 400px;
            border: 1px solid #d1d9e0;
            border-radius: 4px;
            background: white;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-top: 15px;
            padding: 10px;
            background-color: #f8fafc;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }

        .legend-text {
            font-size: 13px;
            font-weight: 600;
            color: #475569;
        }

        .stats-box {
            background-color: #eff6ff;
            border: 2px solid #2563eb;
            border-radius: 6px;
            padding: 20px;
            margin-top: 50px;
            text-align: center;
            color: #1e3a8a;
        }

        @media (max-width: 768px) {
            .section-nav {
                top: 10px;
                right: 10px;
                max-width: 280px;
            }
            .container {
                padding: 15px;
                margin: 0 10px;
            }
            .chart-legend {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
</head>
<body>
    <div class="scroll-progress" id="scrollProgress"></div>

    <div class="section-nav" id="sectionNav">
        <div class="nav-header" onclick="toggleNav()">
            <span class="nav-title">Navigation</span>
            <span class="nav-toggle" id="navToggle">â–¼</span>
        </div>
        <div class="nav-content" id="navContent">
            <a href="#indicator-1" class="nav-sub-item" onclick="scrollToSection('indicator-1')">1. Households - ITN/IRS Coverage</a>
            <a href="#indicator-2" class="nav-sub-item" onclick="scrollToSection('indicator-2')">2. Households - At Least 1 ITN</a>
            <a href="#indicator-3" class="nav-sub-item" onclick="scrollToSection('indicator-3')">3. Population - ITN Use</a>
            <a href="#indicator-4" class="nav-sub-item" onclick="scrollToSection('indicator-4')">4. Children U5 - ITN Use</a>
            <a href="#indicator-5" class="nav-sub-item" onclick="scrollToSection('indicator-5')">5. Pregnant Women - ITN Use</a>
            <a href="#indicator-6" class="nav-sub-item" onclick="scrollToSection('indicator-6')">6. ITN Use Among Access</a>
            <a href="#indicator-7" class="nav-sub-item" onclick="scrollToSection('indicator-7')">7. IPTp 3+ Doses</a>
            <a href="#indicator-8" class="nav-sub-item" onclick="scrollToSection('indicator-8')">8. IPTp 2 Doses</a>
            <a href="#indicator-9" class="nav-sub-item" onclick="scrollToSection('indicator-9')">9. IPTp 1 Dose</a>
            <a href="#indicator-10" class="nav-sub-item" onclick="scrollToSection('indicator-10')">10. Fever - Care Seeking</a>
            <a href="#indicator-11" class="nav-sub-item" onclick="scrollToSection('indicator-11')">11. Fever - Testing</a>
            <a href="#indicator-12" class="nav-sub-item" onclick="scrollToSection('indicator-12')">12. Early Treatment Seeking</a>
            <a href="#indicator-13" class="nav-sub-item" onclick="scrollToSection('indicator-13')">13. ACT Treatment</a>
            <a href="#indicator-14" class="nav-sub-item" onclick="scrollToSection('indicator-14')">14. Malaria Knowledge - Transmission</a>
            <a href="#indicator-15" class="nav-sub-item" onclick="scrollToSection('indicator-15')">15. Malaria Knowledge - Symptoms</a>
        </div>
    </div>

    <div class="container">
        <h1>Outcome Indicators Bar Charts<br><small>Malaria Prevention and Control Program</small></h1>

        <div id="overview" class="section">
            <!-- Overview section removed -->
        </div>

        <!-- Outcome Indicator Charts will be generated by JavaScript -->
        <div id="chartsContainer">
            <!-- Charts will be inserted here -->
        </div>

        <div class="stats-box">
            <h3>Analysis Complete!</h3>
            <p><strong>15 Outcome Indicators analyzed</strong></p>
            <p><strong>Focus:</strong> Baseline, Target and Achieved values comparison</p>
            <p><strong>Categories:</strong> Vector Control, Maternal Health, Child Health, Knowledge & Behavior</p>
        </div>
    </div>

    <script>
        // Outcome Indicators Data
        const outcomeIndicators = [
        {
                "name": "Proportion of households with at least one insecticide-treated net for every two people and/or sprayed by IRS within the last 12 months",
                "shortName": "Households - ITN/IRS Coverage",
                "baseline": 25.0,
                "target": 50.0,
                "achieved": 25.0
        },
        {
                "name": "Percentage of households with at least 1 ITN",
                "shortName": "Households - At Least 1 ITN",
                "baseline": 69.0,
                "target": 80.0,
                "achieved": 61.0
        },
        {
                "name": "Proportion of population that slept under an insecticide-treated net the previous night",
                "shortName": "Population - ITN Use",
                "baseline": 51.0,
                "target": 70.0,
                "achieved": 44.6
        },
        {
                "name": "Proportion of children under five years old who slept under an insecticide-treated net the previous night",
                "shortName": "Children U5 - ITN Use",
                "baseline": 59.0,
                "target": 80.0,
                "achieved": 49.6
        },
        {
                "name": "Proportion of pregnant women who slept under an insecticide-treated net the previous night",
                "shortName": "Pregnant Women - ITN Use",
                "baseline": 64.0,
                "target": 80.0,
                "achieved": 52.2
        },
        {
                "name": "Proportion of population using an insecticide-treated net among those with access to an insecticide-treated net",
                "shortName": "ITN Use Among Access",
                "baseline": 47.0,
                "target": 80.0,
                "achieved": 72.1
        },
        {
                "name": "Proportion of pregnant women who received three or more doses of IPTp",
                "shortName": "IPTp 3+ Doses",
                "baseline": 36.0,
                "target": 60.0,
                "achieved": 52.0
        },
        {
                "name": "Proportion of pregnant women who received two doses of IPTp",
                "shortName": "IPTp 2 Doses",
                "baseline": 74.0,
                "target": 90.0,
                "achieved": 81.0
        },
        {
                "name": "Proportion of pregnant women who received one dose of IPTp",
                "shortName": "IPTp 1 Dose",
                "baseline": 94.0,
                "target": 100.0,
                "achieved": 92.0
        },
        {
                "name": "Proportion of children < 5 years with fever in the previous 2 weeks for whom advice or treatment was sought",
                "shortName": "Fever - Care Seeking",
                "baseline": 75.0,
                "target": 90.0,
                "achieved": 75.1
        },
        {
                "name": "Proportion of children < 5 years with fever in the previous 2 weeks who had a finger or heel stick",
                "shortName": "Fever - Testing",
                "baseline": 61.0,
                "target": 90.0,
                "achieved": 68.0
        },
        {
                "name": "Proportion of detected cases that contacted health services within 48 hours of symptoms",
                "shortName": "Early Treatment Seeking",
                "baseline": 50.0,
                "target": 80.0,
                "achieved": 40.3
        },
        {
                "name": "Proportion of treatments with ACT (or other appropriate treatment according to national policy) among febrile children < 5 years",
                "shortName": "ACT Treatment",
                "baseline": 97.0,
                "target": 100.0,
                "achieved": 91.0
        },
        {
                "name": "Proportion of women of child bearing age (15-49 years) that report mosquito bite as the cause of malaria",
                "shortName": "Malaria Knowledge - Transmission",
                "baseline": 94.0,
                "target": 100.0,
                "achieved": 98.1
        },
        {
                "name": "Proportion of women of child bearing age (15-49 years) that report fever as a symptom of malaria",
                "shortName": "Malaria Knowledge - Symptoms",
                "baseline": 69.0,
                "target": 80.0,
                "achieved": 83.7
        }
];

        // Function to create individual vertical bar charts with target and achieved values
        function createChart(indicatorData, chartId) {
            const margin = { top: 80, right: 30, bottom: 80, left: 80 };
            const width = 400 - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;

            // Clear any existing content
            d3.select(`#${chartId}`).selectAll("*").remove();

            const svg = d3.select(`#${chartId}`)
                .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Add title
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -50)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "black")
                .text(indicatorData.shortName);

            svg.append("text")
                .attr("x", width / 2)
                .attr("y", -30)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", "black")
                .text("Target vs Achieved");

            // Determine what data to show
            const dataPoints = [];
            dataPoints.push({ label: "Target", value: indicatorData.target, color: "#28a745" });
            if (indicatorData.achieved !== null && indicatorData.achieved !== undefined) {
                dataPoints.push({ label: "Achieved", value: indicatorData.achieved, color: "#007bff" });
            }

            // Create scales
            const xScale = d3.scaleBand()
                .domain(dataPoints.map(d => d.label))
                .range([0, width])
                .padding(0.3);

            const maxValue = Math.max(indicatorData.target, indicatorData.achieved || 0);
            const yScale = d3.scaleLinear()
                .domain([0, Math.ceil(maxValue / 10) * 10]) // Round up to nearest 10
                .range([height, 0]);

            // Add Y-axis
            svg.append("g")
                .call(d3.axisLeft(yScale))
                .style("font-size", "12px");

            // Add Y-axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 20)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .style("font-weight", "bold")
                .style("font-size", "14px")
                .style("fill", "#2c3e50")
                .text("Percentage (%)");

            // Add grid lines
            svg.append("g")
                .attr("class", "grid")
                .call(d3.axisLeft(yScale)
                    .tickSize(-width)
                    .tickFormat("")
                )
                .style("stroke", "#e0e0e0")
                .style("stroke-width", "0.5px");

            // Create the bars
            svg.selectAll(".bar")
                .data(dataPoints)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => xScale(d.label))
                .attr("y", d => yScale(d.value))
                .attr("width", xScale.bandwidth())
                .attr("height", d => height - yScale(d.value))
                .attr("fill", d => d.color)
                .attr("opacity", 0.8)
                .attr("rx", 4)
                .on("mouseover", function() {
                    d3.select(this).attr("opacity", 1);
                })
                .on("mouseout", function() {
                    d3.select(this).attr("opacity", 0.8);
                });

            // Add value labels on top of bars
            svg.selectAll(".bar-label")
                .data(dataPoints)
                .enter()
                .append("text")
                .attr("class", "bar-label")
                .attr("x", d => xScale(d.label) + xScale.bandwidth() / 2)
                .attr("y", d => yScale(d.value) - 10)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .style("fill", d => d.color)
                .text(d => d.value + "%");

            // Add variance text if we have both values
            if (indicatorData.achieved !== null && indicatorData.achieved !== undefined) {
                // Calculate variance
                const variance = ((indicatorData.achieved - indicatorData.target) / indicatorData.target * 100);
                
                // Add variance text between bars
                const targetX = xScale("Target") + xScale.bandwidth() / 2;
                const achievedX = xScale("Achieved") + xScale.bandwidth() / 2;
                const midX = (targetX + achievedX) / 2;
                const midY = height - 30; // Position at bottom of chart
                
                const varianceText = `Variance: ${variance >= 0 ? '+' : ''}${variance.toFixed(1)}%`;
                
                const varianceTextEl = svg.append("text")
                    .attr("x", midX)
                    .attr("y", midY)
                    .attr("text-anchor", "middle")
                    .style("font-size", "12px")
                    .style("font-weight", "bold")
                    .style("fill", variance >= 0 ? "#28a745" : "#dc3545")
                    .text(varianceText);

                const varianceBbox = varianceTextEl.node().getBBox();

                svg.append("rect")
                    .attr("x", varianceBbox.x - 3)
                    .attr("y", varianceBbox.y - 2)
                    .attr("width", varianceBbox.width + 6)
                    .attr("height", varianceBbox.height + 4)
                    .attr("fill", "white")
                    .attr("stroke", variance >= 0 ? "#28a745" : "#dc3545")
                    .attr("stroke-width", 1)
                    .attr("rx", 2);

                varianceTextEl.raise();
            }

            // Add X-axis
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(xScale))
                .style("font-size", "14px")
                .style("font-weight", "bold");
        }

        // Navigation functions
        let navExpanded = true;

        function toggleNav() {
            const nav = document.getElementById('sectionNav');
            const content = document.getElementById('navContent');
            const toggle = document.getElementById('navToggle');

            navExpanded = !navExpanded;

            if (navExpanded) {
                content.classList.add('expanded');
                toggle.classList.add('expanded');
            } else {
                content.classList.remove('expanded');
                toggle.classList.remove('expanded');
            }
        }

        function scrollToSection(sectionId) {
            const target = document.getElementById(sectionId);
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                updateActiveNavItem(sectionId);
            }
        }

        function updateActiveNavItem(sectionId) {
            // Clear all active states
            document.querySelectorAll('.nav-main-item, .nav-sub-item').forEach(item => {
                item.classList.remove('active');
            });

            // Set active state for the target section
            const activeItem = document.querySelector(`a[href="#${sectionId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        function updateScrollProgress() {
            const scrollTop = window.pageYOffset;
            const docHeight = document.body.scrollHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            document.getElementById('scrollProgress').style.width = scrollPercent + '%';
        }

        // Initialize charts and navigation
        document.addEventListener('DOMContentLoaded', function() {
            // Create chart containers and charts
            const chartsContainer = document.getElementById('chartsContainer');
            
            outcomeIndicators.forEach((indicator, index) => {
                const chartDiv = document.createElement('div');
                chartDiv.id = `indicator-${index + 1}`;
                chartDiv.className = 'chart-container';
                
                // Create legend HTML - target and achieved only
                let legendHtml = `
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #28a745;"></div>
                            <span class="legend-text">Target</span>
                        </div>
                `;
                
                if (indicator.achieved !== null && indicator.achieved !== undefined) {
                    legendHtml += `
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #007bff;"></div>
                            <span class="legend-text">Achieved</span>
                        </div>
                    `;
                }
                
                legendHtml += `</div>`;
                
                chartDiv.innerHTML = `
                    <div class="chart-title">${index + 1}. ${indicator.name}</div>
                    <svg class="chart-svg" id="chart-${index + 1}"></svg>
                    ${legendHtml}
                `;
                chartsContainer.appendChild(chartDiv);
                
                // Create the chart
                createChart(indicator, `chart-${index + 1}`);
            });

            // Set up scroll progress
            window.addEventListener('scroll', updateScrollProgress);
            updateScrollProgress();

            // Handle anchor clicks
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    scrollToSection(targetId);
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'b') {
                        e.preventDefault();
                        toggleNav();
                    }
                }
            });
        });
    </script>
</body>
</html>